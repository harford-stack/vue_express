<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비밀번호 찾기</title>
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
    <div id="app">
        <h2>비밀번호 찾기</h2>
        <p>회원가입 시 입력한 아이디, 이름, 이메일을 입력해주세요.</p>
        
        <div>
            <label>
                아이디 : <input type="text" v-model="userId" placeholder="아이디 입력">
            </label>
        </div>
        <div>
            <label>
                이름 : <input type="text" v-model="userName" placeholder="이름 입력">
            </label>
        </div>
        <div>
            <label>
                이메일 : <input type="text" v-model="userEmail" placeholder="이메일 입력">
            </label>
        </div>
        <div>
            <button @click="fnResetPwd">임시 비밀번호 발급</button>
        </div>
        <div v-if="tempPassword">
            <p>임시 비밀번호는 <strong>{{ tempPassword }}</strong> 입니다.</p>
            <p>로그인 후 비밀번호를 변경해주세요.</p>
        </div>
        <div>
            <a href="LIB_Login.html">로그인 페이지로 돌아가기</a>
        </div>
    </div>
</body>
</html>

<script>
    
    const app = Vue.createApp({
        data() {
            return {
                userId: "",
                userName: "",
                userEmail: "",
                tempPassword: ""
            };
        },
        methods: {
            fnResetPwd: function() {
                let self = this;
                let param = {
                    userId: self.userId.trim(),
                    name: self.userName.trim(),
                    email: self.userEmail.trim()
                };

                // 입력값 검증
                if(!self.userId || self.userId.trim() === "") {
                    alert("아이디를 입력해주세요");
                    return;
                }
                
                if(!self.userName || self.userName.trim() === "") {
                    alert("이름을 입력해주세요");
                    return;
                }
                
                if(!self.userEmail || self.userEmail.trim() === "") {
                    alert("이메일을 입력해주세요");
                    return;
                }
                
                // 서버에 비밀번호 재설정 요청
                $.ajax({
                    url: "http://localhost:3009/lib/resetPwd",
                    dataType: "json",
                    type: "GET",
                    data: param,
                    success: function(data) {
                        if(data && data.tempPassword) {
                            // 임시 비밀번호 발급 성공
                            self.tempPassword = data.tempPassword;
                        } else {
                            // 임시 비밀번호 발급 실패
                            alert("입력하신 정보와 일치하는 회원 정보가 없습니다.");
                            self.tempPassword = "";
                        }
                    },
                    error: function(xhr, status, error) {
                        alert("오류가 발생했습니다. 다시 시도해주세요.");
                        console.error(error);
                    }
                });
            }
        }
    });

    app.mount('#app');
</script>